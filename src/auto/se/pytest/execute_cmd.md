---
icon: pen-to-square
category:
  - UIè‡ªåŠ¨åŒ–æµ‹è¯•
  - selenium
tag:
  - selenium
  - å…ƒç´ å®šä½
  - pytest
  - cmd
order: 4
sticky: true
---

# æ‰§è¡Œå‘½ä»¤

ä»¥ä¸‹æ˜¯ **pytest æ‰§è¡Œå‘½ä»¤çš„è¯¦ç»†æŒ‡å—**ï¼Œæ¶µç›–ç›®å½•ã€æ¨¡å—ã€ç”¨ä¾‹ç­›é€‰åŠå¸¸ç”¨å‚æ•°ç»„åˆï¼ŒåŠ©ä½ ç²¾å‡†æ§åˆ¶æµ‹è¯•èŒƒå›´ï¼š

---

### **ä¸€ã€åŸºç¡€æ‰§è¡Œå‘½ä»¤**

#### **1. è¿è¡Œæ‰€æœ‰æµ‹è¯•**
```bash
pytest
```
- **é»˜è®¤è¡Œä¸º**ï¼šé€’å½’æŸ¥æ‰¾å½“å‰ç›®å½•åŠå­ç›®å½•ä¸­æ‰€æœ‰ `test_*.py` å’Œ `*_test.py` æ–‡ä»¶ï¼Œæ‰§è¡Œå…¶ä¸­ä»¥ `test_` å¼€å¤´çš„å‡½æ•°/æ–¹æ³•ã€‚

#### **2. æŒ‡å®šæµ‹è¯•ç›®å½•**
```bash
pytest tests/          # æ‰§è¡Œ tests ç›®å½•ä¸‹çš„æ‰€æœ‰æµ‹è¯•
pytest src/tests/api  # æŒ‡å®šåµŒå¥—ç›®å½•
```

#### **3. æŒ‡å®šæµ‹è¯•æ¨¡å—**
```bash
pytest tests/test_login.py            # å•æ–‡ä»¶
pytest tests/test_*.py               # é€šé…ç¬¦åŒ¹é…å¤šä¸ªæ–‡ä»¶
pytest "tests/old tests/test_api.py"  # è·¯å¾„å«ç©ºæ ¼æ—¶ç”¨å¼•å·åŒ…è£¹
```

#### **4. æŒ‡å®šæµ‹è¯•ç±»/æ–¹æ³•**
```bash
pytest tests/test_user.py::TestUser            # ç±»ä¸­çš„æ‰€æœ‰æµ‹è¯•
pytest tests/test_api.py::test_get_token       # å•ä¸ªå‡½æ•°
pytest tests/db/test_models.py::TestUser::test_create  # ç±»ä¸­çš„ç‰¹å®šæ–¹æ³•
```

---

### **äºŒã€ç²¾å‡†ç­›é€‰æµ‹è¯•ç”¨ä¾‹**
#### **1. æŒ‰åç§°æ¨¡ç³ŠåŒ¹é…ï¼ˆ`-k`ï¼‰**
```bash
pytest -k "login and not admin"  # åç§°åŒ…å« "login" ä¸”ä¸åŒ…å« "admin" çš„æµ‹è¯•
```

#### **2. æŒ‰æ ‡è®°è¿‡æ»¤ï¼ˆ`-m`ï¼‰**
```bash
pytest -m "smoke and db"  # è¿è¡ŒåŒæ—¶æœ‰ @pytest.mark.smoke å’Œ @pytest.mark.db æ ‡è®°çš„æµ‹è¯•
```

#### **3. æŒ‰èŠ‚ç‚¹IDè¿è¡Œ**
å…ˆè·å–å®Œæ•´èŠ‚ç‚¹IDï¼š
```bash
pytest --collect-only -q  # åˆ—å‡ºæ‰€æœ‰æµ‹è¯•çš„èŠ‚ç‚¹ID
```
ç„¶åæ‰§è¡Œï¼š
```bash
pytest tests/test_api.py::test_login[param1]  # å‚æ•°åŒ–æµ‹è¯•çš„ç‰¹å®šå‚æ•°ç»„åˆ
```

---

### **ä¸‰ã€å¸¸ç”¨å‚æ•°ç»„åˆ**
#### **1. åŸºç¡€ç»„åˆ**
```bash
pytest -v                  # æ˜¾ç¤ºè¯¦ç»†è¾“å‡ºï¼ˆæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åç§°ï¼‰
pytest --tb=short          # ç®€åŒ–é”™è¯¯è·Ÿè¸ªä¿¡æ¯ï¼ˆå¯é€‰: auto, long, line, nativeï¼‰
pytest --lf                # ä»…è¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•ï¼ˆ--last-failedï¼‰
pytest --ff                # å…ˆè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•ï¼Œå†æ‰§è¡Œå…¶ä»–ï¼ˆ--failed-firstï¼‰
```

#### **2. å¹¶è¡ŒåŠ é€Ÿ**
```bash
pytest -n 4               # ä½¿ç”¨4ä¸ªè¿›ç¨‹å¹¶è¡Œï¼ˆéœ€å®‰è£… pytest-xdistï¼‰
pytest -n auto            # è‡ªåŠ¨æ£€æµ‹ CPU æ ¸å¿ƒæ•°
```

#### **3. è¦†ç›–ç‡æŠ¥å‘Š**
```bash
pytest --cov=my_project --cov-report=html  # ç”Ÿæˆ HTML è¦†ç›–ç‡æŠ¥å‘Šï¼ˆéœ€å®‰è£… pytest-covï¼‰
```

---

### **å››ã€å®æˆ˜åœºæ™¯ç¤ºä¾‹**
#### **åœºæ™¯ 1ï¼šå¿«é€ŸéªŒè¯ä¿®å¤çš„ Bug**
```bash
pytest --lf -v  # ä»…é‡è·‘ä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•ï¼Œå¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
```

#### **åœºæ™¯ 2ï¼šCI/CD ä¸­çš„æŒ‡å®šæ¨¡å—æµ‹è¯•**
```bash
pytest tests/db/ -m "not slow"  # æ‰§è¡Œ db ç›®å½•ä¸‹æ‰€æœ‰éæ…¢é€Ÿæµ‹è¯•
```

#### **åœºæ™¯ 3ï¼šå‚æ•°åŒ–æµ‹è¯•çš„ç‰¹å®šç”¨ä¾‹**
```bash
pytest tests/test_api.py::test_search[case1]  # ä»…è¿è¡Œå‚æ•°åŒ–ä¸º case1 çš„æµ‹è¯•
```

---

### **äº”ã€é…ç½®æ–‡ä»¶é¢„è®¾**
åœ¨ `pytest.ini` ä¸­é¢„è®¾å¸¸ç”¨å‚æ•°ï¼š
```ini
# pytest.ini
[pytest]
addopts = -v --tb=short -n auto
python_files = test_*.py check_*.py  # è‡ªå®šä¹‰æµ‹è¯•æ–‡ä»¶åŒ¹é…æ¨¡å¼
markers =
    smoke: å†’çƒŸæµ‹è¯•
    db: æ•°æ®åº“ç›¸å…³æµ‹è¯•
```

---

### **å…­ã€æ€»ç»“**
- **ç²¾å‡†å®šä½**ï¼šé€šè¿‡è·¯å¾„ã€èŠ‚ç‚¹IDã€æ ‡è®° (`-m`) å’Œåç§° (`-k`) å¿«é€Ÿç­›é€‰æµ‹è¯•
- **é«˜æ•ˆæ‰§è¡Œ**ï¼šå¹¶è¡Œ (`-n`) + å¤±è´¥ä¼˜å…ˆ (`--lf/--ff`) åŠ é€Ÿåé¦ˆå¾ªç¯
- **ç»“æœåˆ†æ**ï¼šç»“åˆ `--cov` å’Œ `-v` è·å–è¯¦ç»†è´¨é‡åé¦ˆ

çµæ´»ç»„åˆè¿™äº›å‘½ä»¤å‚æ•°ï¼Œå¯æ˜¾è‘—æå‡æµ‹è¯•æ‰§è¡Œæ•ˆç‡ï¼ ğŸš€