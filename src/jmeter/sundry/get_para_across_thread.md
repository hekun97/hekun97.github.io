#  Jmeter 跨线程组取参数值的方法

- 用过 Jmeter 的同学应该都知道，Jmeter 不支持跨线程传递参数
- 哎，那我想跨线程传递参数，要咋整呢？别急，接下来我们就来讲解如何不使用代码就可以解决此问题
- 官方也有正式说明，所以这并不是 Bug 哦

[![img](/assets/jmeter/1896874-20200713102945512-268679554.jpg)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713102945512-268679554.jpg)

 

::: tip 一定要通过 BeanShell 去跨线程组传递参数吗？

- 通过百度搜索：Jmeter 跨线程组传递参数
- 会看到很多文章都是通过 BeanShell 写代码去实现的
- 这对于代码小白极其不友好！
- 所以这篇文章将教会大家如何**不需要写代码**去实现跨线程传递参数！

::: 

## 一、定义属性法

### 思路

- 在Jmeter 中，属性是**全局生效**的，可以动态设置
- 但变量是每个线程独有的
- 所以通过设置属性可以实现跨线程传参，而不是通过变量的方式

 

### 测试计划结构树

[![img](/assets/jmeter/1896874-20200713112809505-361272313.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713112809505-361272313.png)

**第一步**

1. 添加了三个线程组
2. 登录需要注册接口返回的手机号
3. 获取订单列表需要登录接口返回的token，均需要跨线程组传参

 

### 注册接口的 Json 提取器

[![img](/assets/jmeter/1896874-20200713114058764-1468730754.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713114058764-1468730754.png)

**第二步：**通过提取器（json、正则、xpath），提取需要跨线程组传递的值

 

### 注册接口的 BeanShell 后置处理器

[![img](/assets/jmeter/1896874-20200713113934822-1573598535.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713113934822-1573598535.png)

**第三步**

1. 添加一个 BeanShell 后置处理器
2. 添加一个 ${__setProperty()} 函数，按照图片说明写变量名

 

### 登录接口的请求体

[![img](/assets/jmeter/1896874-20200713114416648-92433861.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713114416648-92433861.png)

**第四步**

1. 引用第三步在 BeanShell 后置处理器设置的变量名（phone）
2. 通过 ${__P()} 来读取对应的属性值

 

### **第五步**

运行脚本！就能发现可以跨线程组传递参数啦

 

### 登录接口的 BeanShell 后置处理器

[![img](/assets/jmeter/1896874-20200713114729240-1228991514.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713114729240-1228991514.png)

一样的步骤，添加 token 属性

 

### 获取订单列表的请求参数

[![img](/assets/jmeter/1896874-20200713114800943-267495909.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713114800943-267495909.png)

获取 token 属性

 

### 查看属性显示

[![img](/assets/jmeter/1896874-20200713114610417-1356655883.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713114610417-1356655883.png)

可以通过属性显示这个控件查看我们在 BeanShell 设置的两个属性名和对应的值（phone、token）

 

### 拓展一下

如果想在一个 BeanShell 设置多个属性，可以这样写哦

[![img](/assets/jmeter/1896874-20200713122247543-77420470.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713122247543-77420470.png)

每个函数之间用 ; 分开即可（建议分）

 

然后可以在属性显示中查看两个不同的属性都会生效

[![img](/assets/jmeter/1896874-20200713122528571-1036306610.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713122528571-1036306610.png)

 

## 二、文件再转接法

### 思路

一个线程组运行结果，存储到文件，另一个线程组，通过csv读取文件，然后再提取文件中需要的值，作为变量输入

 

### 线程组结构树

[![img](/assets/jmeter/1896874-20200713163218530-530054763.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713163218530-530054763.png)

**第一步**

1. 添加两个线程组，写好接口
2. 注册接口后面添加**保存响应文件**（在监听器下面）

 

### 注册接口下的保存响应到文件

[![img](/assets/jmeter/1896874-20200713163224690-2028980819.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713163224690-2028980819.png)

**第二步**

1. 设置保存文件的路径和文件名
2. 记得选项跟着我勾哦，不然生成的文件名就不是你指定的（test.json）

 

### CSV 数据文件设置

[![img](/assets/jmeter/1896874-20200713163231561-1954336458.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713163231561-1954336458.png)

**第三步**

1. 在第二个线程组添加 CSV 数据文件设置
2. **文件名：**设置刚刚保存的路径
3. **分隔符：**json 数据建议填\t ，可以根据自己的数据结构来定，能取出完整的数据就好了

 

 

#### 看看read_phone 的数据是啥

[![img](/assets/jmeter/1896874-20200713163328935-1512513966.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713163328935-1512513966.png)

一个 json 数据

 

### 登录接口的请求体

[![img](/assets/jmeter/1896874-20200713163238520-137993816.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713163238520-137993816.png)

**第四步：**接口正常引用 json 提取器的变量即可

 

### 登录线程组的结果树

[![img](/assets/jmeter/1896874-20200713163652182-456130530.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200713163652182-456130530.png)

 

#### 这里需要注意一点

在真正的请求取样器前面需要加一个调试取样器，上图可以看到第一个取样器无法取到变量值的，**因为提取器都是后置处理器**

所以第二个线程组**元件的执行顺序**会是

1. csv 数据文件设置
2. 调试取样器
3. json 提取器
4. 登录请求