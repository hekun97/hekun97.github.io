---
icon: pen-to-square
category:
  - JMeter
tag:
  - Controller
  - ForEach
order: 6
sticky: true
---



# 详解 ForEach控制器

## 前言

- ForEach 控制器一般和用户自定义变量/JDBC结果变量一起使用，用于可以遍历读取相关的返回值
- 该控制器下的 Samplers 和控制器都会被执行一次或多次，每次读取不同的变量值
- ForEach 控制器和正则提取器是个好搭档，因为正则提取出来的变量值会用_分隔，而 ForEach 可以省略 _ 

 

## ForEach

[![img](/assets/jmeter/1896874-20200703141347472-1283755239.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703141347472-1283755239.png)

 

## ForEach 界面介绍

[![img](/assets/jmeter/1896874-20200703141351108-1518404042.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703141351108-1518404042.png)

 

#### 字段含义

| 字段                            | 含义                                                         |
| :------------------------------ | :----------------------------------------------------------- |
| Input Variable Prefix           | 输入变量名的前缀，默认为一个空字符串作为前缀。               |
| Start index for loop(exclusive) | 循环开始的索引不包括此值默认从 1 开始填 0 则起始索引是 1，填 1 则是 2 |
| End index for loop(inclusive)   | 循环结束的索引包括此值填 100 则结束索引是 100                |
| Output variable                 | 输出的变量名在后续循环中，samplers 可使用的变量名            |
| Add”_”before number             | 输入变量名和索引之间是否有 _ 间隔不勾选的话，则输入变量名和索引直接相连 |

 

## ForEach 结合用户自定义变量的栗子

#### 线程组树结构

[![img](/assets/jmeter/1896874-20200703165202855-1570244898.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703165202855-1570244898.png)

线程组，只有一个线程

 

#### 用户自定义变量

[![img](/assets/jmeter/1896874-20200703165207103-1988572958.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703165207103-1988572958.png)

一共有四个

 

#### ForEach

[![img](/assets/jmeter/1896874-20200703165212845-471223986.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703165212845-471223986.png)

前缀为 name 的有四个变量，所以循环四次

 

#### 运行结果

[![img](/assets/jmeter/1896874-20200703165218112-2084651568.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703165218112-2084651568.png)

 

#### 如果输出变量名称为空，需要怎么取循环的值？

[![img](/assets/jmeter/1896874-20200703165704757-1366572034.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703165704757-1366572034.png)

直接取空即可 ${} 

 

## ForEach 不勾选 Add”_”before number 的栗子

#### 线程组树结构

[![img](/assets/jmeter/1896874-20200703165202855-1570244898.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703165202855-1570244898.png)

 

#### 用户自定义变量

[![img](/assets/jmeter/1896874-20200703171227636-721346752.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703171227636-721346752.png)

 

#### ForEach

[![img](/assets/jmeter/1896874-20200703165212845-471223986.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703165212845-471223986.png)

 

#### 运行结果

[![img](/assets/jmeter/1896874-20200703171233276-947313724.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703171233276-947313724.png)

 

## ForEach 结合 JDBC Request 的栗子一

#### 线程组树结构

[![img](/assets/jmeter/1896874-20200703170616294-1266049532.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703170616294-1266049532.png)

 

#### JDBC 运行结果

[![img](/assets/jmeter/1896874-20200703170621282-1283836304.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703170621282-1283836304.png)

JDBC 一共返回 100 条数据，这里我们是通过 Variable names 去接住所有数据，对应有 100 个变量（mobile_1 到 mobile_100）

 

#### ForEach

[![img](/assets/jmeter/1896874-20200703170706856-2045214002.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703170706856-2045214002.png)

循环 100 次，输入变量 mobile_1 - mobile_100 并输出为 new_mobile_1 - new_mobile_100

 

#### 运行结果

[![img](/assets/jmeter/1896874-20200703170811880-1788937199.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703170811880-1788937199.png)

 

## ForEach 结合 JDBC Request 的栗子二

#### 线程组树结构

[![img](/assets/jmeter/1896874-20200703171319541-285272099.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703171319541-285272099.png)

 

#### JDBC 运行结果

[![img](/assets/jmeter/1896874-20200703171455111-2125012031.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703171455111-2125012031.png)

- 这里通过 Result Variable name 去接住所有数据，只有一个变量，是无法循环的
- 所以我们需要通过**正则提取器**将需要的 mobile 字段的值提取出来

 

#### 正则提取器

[![img](/assets/jmeter/1896874-20200703172004302-1964600823.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703172004302-1964600823.png)

关于正则提取器更多知识点可看：https://www.cnblogs.com/poloyy/p/13179150.html

 

#### 正则提取结果

[![img](/assets/jmeter/1896874-20200703172128888-1272428248.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703172128888-1272428248.png)

我们要的其实是箭头的那些，但是正则会提取不必要的字段值（如：mobile_new_11_g0），所以注意 ForEach 的输入变量前缀要写正确

 

#### ForEach

[![img](/assets/jmeter/1896874-20200703172300840-1888884591.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703172300840-1888884591.png)

循环 100 次，输入变量 mobile_new_1 - mobile_new_100 并输出为 mobile_1 - mobile_100

 

#### 运行结果

[![img](/assets/jmeter/1896874-20200703172308303-730237368.png)](https://img2020.cnblogs.com/blog/1896874/202007/1896874-20200703172308303-730237368.png)